{% extends 'layout.html' %}
{% block title %}Guest Payments{% endblock %}

{% block content %}
<h2>All Guest Payments</h2>
<a href="{{ url_for('guest_payments.add_payment') }}" class="btn btn-primary mb-3">➕ Add Payment</a>
<form method="get" class="form-inline mb-3">
  <label for="eventFilter">Filter by Event:</label>
  <select name="event_id" id="eventFilter" class="form-control mx-2" onchange="this.form.submit()">
    <option value="">-- All Events --</option>
    {% for event in events %}
      <option value="{{ event.id }}" {% if selected_event_id == event.id %}selected{% endif %}>
        {{ event.name }}
      </option>
    {% endfor %}
  </select>
</form>

<table class="table table-bordered">
  <thead>
    <tr class="table-secondary fw-bold">
      <td colspan="4" class="text-end">Total:</td>
      <td colspan="2">₹{{ '{:,.2f}'.format(total_amount) }}</td>
      </tr>
    <tr>
      <th>ID</th>
      <th>Guest</th>
      <th>Event</th>
      <th>Amount</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    
    {% for payment in payments  %}
    <tr>
      <td>{{ payment.id }}</td>
      <td>{{ payment.guest.name }}</td>
      <td>{{ payment.event.name }}</td>
      <td>₹{{ '%.2f' % payment.amount }}</td>
      
      <td><div class="d-flex flex-wrap gap-2">
        <a href="{{ url_for('guest_payments.edit_payment', id=payment.id) }}" class="btn btn-warning btn-sm">Edit</a>
        <form method="POST" action="{{ url_for('guest_payments.delete_payment', id=payment.id) }}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this payment?');">
          <button type="submit" class="btn btn-danger btn-sm">Delete</button>
        </form>
      </div></td>
    </tr>
    {% endfor %}
    <!-- Total Row -->
    <tr class="table-secondary fw-bold">
      <td colspan="3" class="text-end">Total (This Page):</td>
      <td colspan="3">₹{{ '{:,.2f}'.format(total_own) }}</td>
      
      </tr>
  </tbody>
</table>
<!-- Pagination -->
<nav>
  <ul class="pagination">
    {% if pagination.has_prev %}
    <li class="page-item">
      <a class="page-link" href="{{ url_for('guest_payments.list_payments', page=pagination.prev_num) }}">&laquo; Prev</a>
    </li>
    {% else %}
    <li class="page-item disabled"><span class="page-link">&laquo; Prev</span></li>
    {% endif %}

    {% for page_num in pagination.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
      {% if page_num %}
        {% if page_num == pagination.page %}
        <li class="page-item active"><span class="page-link">{{ page_num }}</span></li>
        {% else %}
        <li class="page-item"><a class="page-link" href="{{ url_for('guest_payments.list_payments', page=page_num) }}">{{ page_num }}</a></li>
        {% endif %}
      {% else %}
      <li class="page-item disabled"><span class="page-link">…</span></li>
      {% endif %}
    {% endfor %}

    {% if pagination.has_next %}
    <li class="page-item">
      <a class="page-link" href="{{ url_for('guest_payments.list_payments', page=pagination.next_num) }}">Next &raquo;</a>
    </li>
    {% else %}
    <li class="page-item disabled"><span class="page-link">Next &raquo;</span></li>
    {% endif %}
  </ul>
</nav>
{% endblock %}